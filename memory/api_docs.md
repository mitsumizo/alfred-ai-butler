# AI執事「アルフレッド」API仕様

## ユーザー認証API

| API名        | エンドポイント   | メソッド | 役割                       |
| ------------ | ---------------- | -------- | -------------------------- |
| ユーザー登録 | `/auth/register` | POST     | 新規ユーザーアカウント作成 |
| ログイン     | `/auth/login`    | POST     | ユーザー認証とトークン発行 |
| ログアウト   | `/auth/logout`   | POST     | 現在のセッションを終了     |
| トークン更新 | `/auth/refresh`  | POST     | アクセストークンの更新     |

## 設定資料API

| API名                    | エンドポイント              | メソッド | 役割                                 |
| ------------------------ | --------------------------- | -------- | ------------------------------------ |
| 設定ファイル一覧取得     | `/settings/files`           | GET      | 保存済み設定ファイル一覧の取得       |
| 設定ファイルアップロード | `/settings/upload`          | POST     | 新規設定ファイルのアップロードと処理 |
| 設定ファイル取得         | `/settings/files/{file_id}` | GET      | 特定の設定ファイル内容の取得         |
| 設定ファイル更新         | `/settings/files/{file_id}` | PUT      | 既存設定ファイルの内容更新           |
| 設定ファイル削除         | `/settings/files/{file_id}` | DELETE   | 設定ファイルの削除                   |
| 設定カテゴリ作成         | `/settings/categories`      | POST     | 設定ファイルのカテゴリ作成           |
| 設定カテゴリ一覧         | `/settings/categories`      | GET      | 設定ファイルカテゴリ一覧取得         |

## チャットAPI

| API名                | エンドポイント  | メソッド | 役割                             |
| -------------------- | --------------- | -------- | -------------------------------- |
| メッセージ送信       | `/chat/message` | POST     | ユーザーメッセージ送信と応答取得 |
| 会話履歴取得         | `/chat/history` | GET      | 過去の会話履歴の取得             |
| 会話履歴削除         | `/chat/history` | DELETE   | 会話履歴の削除                   |
| 会話コンテキスト設定 | `/chat/context` | POST     | チャットの文脈情報の設定         |
| 会話開始             | `/chat/start`   | POST     | 新規会話セッションの開始         |
| 会話終了             | `/chat/end`     | POST     | 現在の会話セッションの終了       |

## 執事キャラクターAPI

| API名            | エンドポイント    | メソッド | 役割                       |
| ---------------- | ----------------- | -------- | -------------------------- |
| 執事設定取得     | `/butler/profile` | GET      | 執事の人格設定情報取得     |
| 執事設定更新     | `/butler/profile` | PUT      | 執事の人格設定の更新       |
| 対応スタイル一覧 | `/butler/styles`  | GET      | 使用可能な応対スタイル一覧 |
| 対応スタイル変更 | `/butler/style`   | PUT      | 執事の対応スタイル変更     |

## 管理API
| API名            | エンドポイント           | メソッド | 役割                         |
| ---------------- | ------------------------ | -------- | ---------------------------- |
| システム状態     | `/admin/status`          | GET      | システムの稼働状態確認       |
| ベクトルDB再構築 | `/admin/rebuild-vectors` | POST     | ベクトルデータベースの再構築 |
| 使用統計         | `/admin/stats`           | GET      | 使用状況の統計情報取得       |
| キャッシュクリア | `/admin/clear-cache`     | POST     | システムキャッシュのクリア   |

## 検索API
| API名          | エンドポイント    | メソッド | 役割                   |
| -------------- | ----------------- | -------- | ---------------------- |
| 設定情報検索   | `/search`         | POST     | 設定情報の検索         |
| 類似文書検索   | `/search/similar` | POST     | 類似文書の検索         |
| キーワード検索 | `/search/keyword` | POST     | キーワードベースの検索 |

各APIはJSONフォーマットでデータをやり取りし、認証が必要なエンドポイントではリクエストヘッダーに`Authorization: Bearer {token}`の形式でアクセストークンを含める設計です。

バックエンドAPIは FastAPI で実装され、以下のエンドポイントが提供されています。
ベースURL: `http://localhost:8000`

## チャットAPI

### メッセージ送信
- **エンドポイント**: `/chat`
- **メソッド**: POST
- **説明**: ユーザーのメッセージに対してAI執事として応答します
- **リクエスト本文**:
  ```json
  {
    "message": "ユーザーからの質問やメッセージ"
  }
  ```
- **レスポンス**:
  ```json
  {
    "response": "AI執事からの応答メッセージ",
    "source_documents": [
      {
        "content": "参照された設定資料の内容",
        "metadata": {
          "source": "設定ファイル名/ID"
        }
      }
    ]
  }
  ```

## 設定API

### 設定ファイルのアップロード
- **エンドポイント**: `/settings/upload`
- **メソッド**: POST
- **説明**: 設定ファイルの内容をアップロードし、ベクトルデータベースに保存します
- **リクエスト本文**:
  ```json
  {
    "content": "設定ファイルのテキスト内容"
  }
  ```
- **レスポンス**:
  ```json
  {
    "success": true,
    "message": "設定ファイルが正常に処理されました",
    "content_length": 1234
  }
  ```

## エラーレスポンス

すべてのエンドポイントは、エラー発生時に以下の形式でレスポンスを返します：

```json
{
  "detail": "エラーメッセージの詳細"
}
```

主なHTTPステータスコード：
- 400: リクエストの形式が不正
- 404: リソースが見つからない
- 500: サーバー内部エラー 